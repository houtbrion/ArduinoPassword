# ArduinoPassword

SDに入っているパスワードファイルを用いて，ユーザ認証を行う際に利用するライブラリ．

## パスワードファイル
パスワードファイルの形式は以下のようなものにしてください．
```
ユーザ名1:SHA3-512で符号化したパスワード1
ユーザ名2:SHA3-512で符号化したパスワード2
   ：
ユーザ名n:SHA3-512で符号化したパスワードn
```

本ライブラリは空行は無視しますし，「#」で始まる行はコメントとして無視する作りになっています．

### パスワードファイル中の1つのエントリの実例
```
bar:4aab610f2d9f261cd5a4cc600ac97f2248ddfe0b2d73312707907717707604dfa9d16ad9f096fd9a743a34ff4c9a35d7410ac8051fb8a24f61da43f2d37effed
```

実際のパスワードファイルの例はサンプルプログラム(examplesディレクトリ以下)にスケッチと一緒に格納してあるので，そちらを参照してください．

### パスワードの符号化方法
パスワードファイルには，SHA3-512で符号化したパスワードを格納しておく必要がありますが，この符号化したパスワードは次のように作成します．

オンラインで文字列やデータを「SHA3-512」で符号化するサービスを提供しているサイトは多いので，各ユーザにそのURLを通知して自分のパスワードを符号化してもらったものを集めます．

それを上のファイルの形式でSDに保存し，Arduinoに接続します(SDシールド等を使ってください)．

## 依存するライブラリ
本ライブラリは，SHA3-512で符号化したパスワードを含んだファイルをSDに入れていることを前提としているので，以下の2種類のライブラリを事前にインストールしておく必要があります．ただし，AVRはSDのライブラリがデフォルトでインストールされているはずなので，AVRでは暗号化のライブラリのみを追加インストールするだけで済むはずです．

- [暗号化ライブラリ](https://rweather.github.io/arduinolibs/crypto.html)
- SD用ライブラリ(AVRでは開発環境に含まれている)

## ライブラリの使い方
使い方は非常にシンプルなため，サンプルプログラムで説明します．

### 事前準備
サンプルプログラムに同封した「pass.txt」をSDにコピーし，そのSD(もしくはマイクロSD)をArduinoに接続します．

### サンプルプログラムの動作
このプログラムでは，通信もしくは，シリアルからユーザ名とパスワード文字列を取得し，そのユーザ名とパスワードの組み合わせがパスワードファイルに存在するか否かを判定します．

```
char sample_user_name[]="hoge";  // ユーザ名
char sample_passwd_str[]="foo";  // パスワード(符号化していないもの)

#define CHIP_SELECT 4            // SDカードのチップセレクトピン番号

#include <ArduinoPassword.h>     // 本ライブラリのヘッダをインクルード

Passwd passwdDB;                 // 本ライブラリのクラスオブジェクトを生成

/*
 * 
 */
void setup() {
  Serial.begin(9600); // ハードウェアシリアルを準備
  while (!Serial) {
    ; // シリアルポートの準備ができるのを待つ(Leonardoのみ必要)
  };

  passwdDB.begin(CHIP_SELECT);  // SDのチップセレクトピン番号を引数にオブジェクトを初期化
  passwdDB.init("pass.txt");    // パスワードファイルのパス名を引数として呼び出し，パスワードファイルを解析し，
                                // オブジェクト内部でパスワードファイルの情報をキャッシュする．
  
  // 認証するユーザ名とパスワード文字列を用いて一致するエントリがあるか否かを確認
  if (passwdDB.CheckPasswd(sample_user_name,sample_passwd_str)) { 
    Serial.println("match");
  } else {
    Serial.println("miss match");
  }
}

void loop() {
  // put your main code here, to run repeatedly:

}
```



